
<div class="container mx-auto py-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <!-- Product Title -->
        <h2 class="text-4xl font-bold text-gray-800 mb-4">{{ product.name }}</h2>

        <!-- Product Image -->
        <div class="flex justify-center mb-6">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-80 h-auto object-cover rounded-lg">
        </div>

        <!-- Product Description -->
        <p class="text-gray-600 mb-4 text-lg">{{ product.description }}</p>

        <!-- Product Price -->
        <p class="text-xl font-semibold text-gray-800 mb-6">Price: Ksh {{ product.price }}</p>

        <!-- Order Button -->
        <p>Product ID: {{ product.id }}</p>
        <div class="flex justify-center">
            <button onclick="lipa_na_mpesa_online({ product_id })" class="bg-blue-600 text-white py-3 px-6 rounded-full text-lg hover:bg-blue-700 transition duration-300">
                Order Now
            </button>
        </div>
    
    </div>
</div>
<script>
    function lipaNaMpesa() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const amount = document.getElementById('amount').value;

        fetch("{% url 'lipa_na_mpesa_online' product.id %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCookie('csrftoken')  // Required if CSRF is enforced
            },
            body: JSON.stringify({
                phone_number: phoneNumber,
                amount: amount
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log("STK Push Response:", data);
            alert("✅ Payment initiated! Check your phone to complete the transaction.");
        })
        .catch(error => {
            console.error("STK Push Error:", error);
            alert("❌ Failed to initiate payment.");
        });
    }

    // Utility to get CSRF token (in case it's needed)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

